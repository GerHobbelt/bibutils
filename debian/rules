#!/usr/bin/make -f
# -*- makefile -*-
# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

DB2MAN=/usr/share/sgml/docbook/stylesheet/xsl/nwalsh/manpages/docbook.xsl
XP=xsltproc -''-nonet

# Set SONAME
SOMAJOR=2
SOMINOR=0
SONAME="libbibutils.so."$(SOMAJOR)

INSTALLDIR=$(CURDIR)/debian/tmp/bin
DEVLIB=${CURDIR}/debian/libbibutils-dev/usr/lib

%:
	dh $@

override_dh_auto_configure:
	# do the sed ourselves to avoid build dependency on csh
	sed -e 's/REPLACE_CC/CC="cc -Wall"/' \
	    -e 's/REPLACE_RANLIB/RANLIB="ranlib"/'  \
	    -e "s|REPLACE_INSTALLDIR|${INSTALLDIR}|"  \
	    -e 's/REPLACE_POSTFIX//' < Makefile_start > Makefile

override_dh_auto_build:
	$(MAKE) -C lib -f Makefile.dynamic SONAME=$(SONAME) SOMINOR=$(SOMINOR) all
	$(MAKE) -C bin -f Makefile.dynamic all
	$(XP) -o bibutils.1 $(DB2MAN) bibutils.dbk
	make -C test all
	make -C test test

override_dh_auto_install:
	mkdir -p ${INSTALLDIR}
	$(MAKE) SOVERSION=$(SOVERSION) install
	mkdir -p ${DEVLIB} && ln -s ${SONAME} ${DEVLIB}/libbibutils.so

